<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoRunner - Server Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-cyan: #00f0ff;
            --neon-magenta: #ff00ff;
            --neon-blue: #0066ff;
            --neon-purple: #8800ff;
            --neon-green: #00ff88;
            --neon-orange: #ff8800;
            --neon-red: #ff0055;
            --bg-dark: #0a0a1a;
            --glow-cyan: 0 0 20px rgba(0, 240, 255, 0.5), 0 0 40px rgba(0, 240, 255, 0.3);
            --glow-magenta: 0 0 20px rgba(255, 0, 255, 0.5), 0 0 40px rgba(255, 0, 255, 0.3);
            --glow-blue: 0 0 20px rgba(0, 102, 255, 0.5), 0 0 40px rgba(0, 102, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @keyframes gradientBg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes borderGlow {
            0%, 100% { border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0, 240, 255, 0.3), inset 0 0 15px rgba(0, 240, 255, 0.1); }
            33% { border-color: var(--neon-magenta); box-shadow: 0 0 15px rgba(255, 0, 255, 0.3), inset 0 0 15px rgba(255, 0, 255, 0.1); }
            66% { border-color: var(--neon-blue); box-shadow: 0 0 15px rgba(0, 102, 255, 0.3), inset 0 0 15px rgba(0, 102, 255, 0.1); }
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }

        @keyframes pulseNeon {
            0%, 100% { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor; }
            50% { text-shadow: 0 0 5px currentColor, 0 0 10px currentColor; }
        }

        body {
            font-family: 'Rajdhani', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 25%, #0a0a2a 50%, #1a0a3a 75%, #0a0a1a 100%);
            background-size: 400% 400%;
            animation: gradientBg 15s ease infinite;
            color: #e0e0f0;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0, 240, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(255, 0, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 102, 255, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
            animation: scanline 8s linear infinite;
            opacity: 0.3;
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        header {
            background: rgba(10, 10, 30, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(0, 240, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 0 30px rgba(0, 240, 255, 0.05);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            animation: borderGlow 6s ease-in-out infinite;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.1), transparent);
            animation: headerShine 4s ease-in-out infinite;
        }

        @keyframes headerShine {
            0%, 100% { left: -100%; }
            50% { left: 100%; }
        }
        
        header h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-cyan);
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5), 0 0 20px rgba(0, 240, 255, 0.3);
            letter-spacing: 2px;
        }
        
        header p {
            color: rgba(200, 200, 220, 0.8);
            font-size: 14px;
            font-weight: 500;
        }

        header p strong {
            color: var(--neon-cyan);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(10, 10, 30, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(0, 240, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 240, 255, 0.03);
            padding: 24px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta), var(--neon-blue), var(--neon-cyan));
            background-size: 300% 100%;
            animation: gradientBg 4s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card::after {
            content: '';
            position: absolute;
            bottom: 0; right: 0;
            width: 100px; height: 100px;
            background: radial-gradient(circle at bottom right, rgba(255, 0, 255, 0.1), transparent 70%);
            pointer-events: none;
        }
        
        .card:hover {
            border-color: rgba(0, 240, 255, 0.5);
            box-shadow: 0 15px 50px rgba(0, 240, 255, 0.15), 0 0 30px rgba(0, 240, 255, 0.1), inset 0 0 30px rgba(0, 240, 255, 0.05);
        }

        .card:hover::before {
            opacity: 1;
        }
        
        .card h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-cyan);
            margin-bottom: 18px;
            font-size: 18px;
            font-weight: 600;
            text-shadow: 0 0 8px rgba(0, 240, 255, 0.4);
            letter-spacing: 1px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 240, 255, 0.15);
            transition: all 0.3s ease;
        }

        .stat:hover {
            background: rgba(0, 240, 255, 0.05);
            padding-left: 8px;
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: rgba(200, 200, 220, 0.7);
            font-weight: 500;
        }
        
        .stat-value {
            color: var(--neon-cyan);
            font-weight: 700;
            text-shadow: 0 0 8px rgba(0, 240, 255, 0.3);
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            margin-top: 10px;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .status-running {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
            animation: pulseNeon 2s ease-in-out infinite;
        }
        
        .status-stopped {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.2), rgba(255, 0, 85, 0.1));
            color: var(--neon-red);
            border: 1px solid var(--neon-red);
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.3);
        }
        
        button {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.3), rgba(136, 0, 255, 0.3));
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 10px;
            margin-right: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        button:hover::before {
            left: 100%;
        }
        
        button:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.5), rgba(136, 0, 255, 0.5));
            color: #fff;
            box-shadow: var(--glow-cyan);
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(60%);
            border-color: rgba(100, 100, 100, 0.5);
            color: rgba(150, 150, 150, 0.5);
        }
        
        button.danger {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.3), rgba(255, 0, 255, 0.2));
            border-color: var(--neon-red);
            color: var(--neon-red);
        }
        
        button.danger:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.5), rgba(255, 0, 255, 0.3));
            box-shadow: var(--glow-magenta);
            color: #ff6699;
        }
        
        button.success {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 240, 255, 0.2));
            border-color: var(--neon-green);
            color: var(--neon-green);
        }
        
        button.success:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.5), rgba(0, 240, 255, 0.3));
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.5), 0 0 50px rgba(0, 255, 136, 0.3);
            color: #66ffbb;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 8px;
            margin: 8px 0;
            font-family: 'Rajdhani', sans-serif;
            background: rgba(10, 10, 30, 0.6);
            color: #e0e0f0;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.3), inset 0 0 10px rgba(0, 240, 255, 0.1);
        }

        input::placeholder, textarea::placeholder {
            color: rgba(150, 150, 170, 0.6);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: var(--neon-cyan);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        small {
            color: rgba(150, 150, 170, 0.7) !important;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(0, 240, 255, 0.2);
            flex-wrap: wrap;
            padding-bottom: 15px;
        }
        
        .tab-button {
            background: transparent;
            border: 1px solid transparent;
            color: rgba(200, 200, 220, 0.6);
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            margin: 0;
            font-weight: 600;
            position: relative;
        }

        .tab-button::after {
            content: '';
            position: absolute;
            bottom: -2px; left: 0; right: 0;
            height: 3px;
            background: var(--neon-cyan);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .tab-button:hover {
            color: var(--neon-cyan);
            background: rgba(0, 240, 255, 0.1);
        }

        .tab-button:hover::after {
            transform: scaleX(0.5);
        }
        
        .tab-button.active {
            color: var(--neon-cyan);
            background: rgba(0, 240, 255, 0.15);
            border: 1px solid var(--neon-cyan);
            border-bottom-color: transparent;
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
        }

        .tab-button.active::after {
            transform: scaleX(1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .mod-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .mod-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border: 1px solid rgba(0, 240, 255, 0.15);
            margin-bottom: 8px;
            border-radius: 10px;
            background: rgba(10, 10, 30, 0.4);
            transition: all 0.3s ease;
        }

        .mod-item:hover {
            border-color: var(--neon-cyan);
            background: rgba(0, 240, 255, 0.08);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.1);
        }
        
        .mod-info {
            flex: 1;
        }
        
        .mod-name {
            font-weight: 700;
            color: var(--neon-cyan);
            text-shadow: 0 0 5px rgba(0, 240, 255, 0.3);
        }
        
        .mod-size {
            font-size: 12px;
            color: rgba(150, 150, 170, 0.7);
        }
        
        .logs {
            background: rgba(0, 0, 0, 0.6);
            color: var(--neon-green);
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', 'Rajdhani', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.5;
            margin-top: 10px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            box-shadow: inset 0 0 30px rgba(0, 255, 136, 0.05);
        }
        
        .log-line {
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--neon-cyan);
            box-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan), 0 0 30px var(--neon-cyan);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan);
            }
            50% { 
                opacity: 0.5;
                transform: scale(0.8);
                box-shadow: 0 0 5px var(--neon-cyan);
            }
        }
        
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 10px;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        
        .alert-success {
            background: rgba(0, 255, 136, 0.15);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
        }
        
        .alert-error {
            background: rgba(255, 0, 85, 0.15);
            color: var(--neon-red);
            border: 1px solid var(--neon-red);
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.2);
        }
        
        .alert-info {
            background: rgba(0, 240, 255, 0.15);
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
        }
        
        .alert-warning {
            background: rgba(255, 136, 0, 0.15);
            color: var(--neon-orange);
            border: 1px solid var(--neon-orange);
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.2);
        }
        
        .installer-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 18px 28px;
            border-radius: 12px;
            text-decoration: none;
            color: white;
            font-weight: 700;
            transition: all 0.3s ease;
            min-width: 130px;
            cursor: pointer;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }
        .installer-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        .installer-btn:hover::before {
            left: 100%;
        }
        .installer-btn:hover {
            box-shadow: 0 0 25px rgba(0, 240, 255, 0.3);
        }
        .installer-bat { 
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.3), rgba(0, 102, 255, 0.3));
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
        }
        .installer-bat:hover { box-shadow: var(--glow-cyan); }
        .installer-ps1 { 
            background: linear-gradient(135deg, rgba(136, 0, 255, 0.3), rgba(0, 102, 255, 0.3));
            border-color: var(--neon-purple);
            box-shadow: 0 0 20px rgba(136, 0, 255, 0.2);
        }
        .installer-ps1:hover { box-shadow: 0 0 25px rgba(136, 0, 255, 0.5), 0 0 50px rgba(136, 0, 255, 0.3); }
        .installer-sh { 
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.3), rgba(255, 136, 0, 0.3));
            border-color: var(--neon-orange);
            box-shadow: 0 0 20px rgba(255, 136, 0, 0.2);
        }
        .installer-sh:hover { box-shadow: 0 0 25px rgba(255, 136, 0, 0.5), 0 0 50px rgba(255, 136, 0, 0.3); }
        .installer-icon { font-size: 24px; margin-bottom: 6px; }
        .installer-label { font-size: 18px; font-weight: 800; font-family: 'Orbitron', sans-serif; }
        .installer-desc { font-size: 12px; opacity: 0.85; margin-top: 4px; }
        
        .quarantine-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 136, 0, 0.1);
            border: 1px solid rgba(255, 136, 0, 0.3);
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        .quarantine-item:hover {
            background: rgba(255, 136, 0, 0.15);
            border-color: var(--neon-orange);
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.2);
        }
        .quarantine-item .q-info { flex: 1; }
        .quarantine-item .q-name { font-weight: 700; color: var(--neon-orange); text-shadow: 0 0 5px rgba(255, 136, 0, 0.3); }
        .quarantine-item .q-reason { color: rgba(200, 200, 220, 0.6); font-size: 12px; }
        .quarantine-item .q-restore {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 255, 136, 0.2));
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }
        .quarantine-item .q-restore:hover { 
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.5), rgba(0, 255, 136, 0.3));
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
        }
        .quarantine-item .q-delete {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.3), rgba(255, 0, 85, 0.2));
            border: 1px solid var(--neon-red);
            color: var(--neon-red);
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-left: 6px;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }
        .quarantine-item .q-delete:hover { 
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.5), rgba(255, 0, 85, 0.3));
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
        }
        
        .event-timeline { 
            max-height: 300px; 
            overflow-y: auto; 
            padding-right: 10px;
        }
        .event-timeline::-webkit-scrollbar {
            width: 6px;
        }
        .event-timeline::-webkit-scrollbar-track {
            background: rgba(0, 240, 255, 0.1);
            border-radius: 3px;
        }
        .event-timeline::-webkit-scrollbar-thumb {
            background: var(--neon-cyan);
            border-radius: 3px;
        }
        .event-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 240, 255, 0.1);
            font-size: 13px;
            transition: all 0.3s ease;
        }
        .event-item:hover {
            background: rgba(0, 240, 255, 0.05);
            padding-left: 8px;
        }
        .event-item:last-child { border-bottom: none; }
        .event-time { color: rgba(150, 150, 170, 0.6); font-size: 11px; white-space: nowrap; }
        .event-type {
            font-weight: 700;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            white-space: nowrap;
            font-family: 'Orbitron', sans-serif;
        }
        .event-type-crash { 
            background: rgba(255, 0, 85, 0.2); 
            color: var(--neon-red); 
            border: 1px solid var(--neon-red);
        }
        .event-type-heal { 
            background: rgba(0, 255, 136, 0.2); 
            color: var(--neon-green); 
            border: 1px solid var(--neon-green);
        }
        .event-type-quarantine { 
            background: rgba(255, 136, 0, 0.2); 
            color: var(--neon-orange); 
            border: 1px solid var(--neon-orange);
        }
        .event-type-restart { 
            background: rgba(0, 240, 255, 0.2); 
            color: var(--neon-cyan); 
            border: 1px solid var(--neon-cyan);
        }
        .event-type-default { 
            background: rgba(150, 150, 170, 0.2); 
            color: rgba(200, 200, 220, 0.8); 
            border: 1px solid rgba(150, 150, 170, 0.3);
        }
        .event-msg { color: rgba(200, 200, 220, 0.8); flex: 1; }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            button {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 20, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: linear-gradient(135deg, rgba(10, 10, 30, 0.95), rgba(20, 20, 50, 0.95));
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(0, 240, 255, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(0, 240, 255, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid rgba(0, 240, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 240, 255, 0.05);
        }
        .modal-header h2 {
            color: var(--neon-cyan);
            margin: 0;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        }
        .modal-header .close-btn {
            background: transparent;
            border: 1px solid var(--neon-red);
            color: var(--neon-red);
            font-size: 20px;
            cursor: pointer;
            padding: 4px 12px;
            margin: 0;
            line-height: 1;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .modal-header .close-btn:hover {
            background: rgba(255, 0, 85, 0.2);
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.3);
        }
        .modal-toolbar {
            padding: 16px 24px;
            border-bottom: 1px solid rgba(0, 240, 255, 0.2);
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            background: rgba(0, 240, 255, 0.03);
        }
        .modal-toolbar button {
            margin: 0;
            padding: 8px 18px;
            font-size: 13px;
        }
        .modal-toolbar .search-box {
            flex: 1;
            min-width: 200px;
            margin: 0;
        }
        .modal-toolbar .selected-count {
            color: var(--neon-cyan);
            font-size: 13px;
            font-weight: 600;
        }
        .modal-body {
            overflow-y: auto;
            padding: 0;
            flex: 1;
        }
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        .modal-body::-webkit-scrollbar-track {
            background: rgba(0, 240, 255, 0.05);
        }
        .modal-body::-webkit-scrollbar-thumb {
            background: var(--neon-cyan);
            border-radius: 4px;
        }
        .modal-mod-item {
            display: flex;
            align-items: center;
            padding: 14px 24px;
            border-bottom: 1px solid rgba(0, 240, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .modal-mod-item:hover {
            background: rgba(0, 240, 255, 0.08);
        }
        .modal-mod-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0 14px 0 0;
            cursor: pointer;
            accent-color: var(--neon-cyan);
        }
        .modal-mod-item .mod-title {
            font-weight: 600;
            color: #e0e0f0;
            flex: 1;
        }
        .modal-mod-item .mod-source {
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            color: white;
            margin-right: 8px;
            flex-shrink: 0;
            font-family: 'Orbitron', sans-serif;
        }
        .mod-source.modrinth { background: var(--neon-green); text-shadow: 0 0 5px rgba(0, 255, 136, 0.5); }
        .mod-source.curseforge { background: var(--neon-orange); text-shadow: 0 0 5px rgba(255, 136, 0, 0.5); }
        .mod-source.both { background: var(--neon-purple); text-shadow: 0 0 5px rgba(136, 0, 255, 0.5); }
        .mod-installed-badge {
            font-size: 9px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(0, 240, 255, 0.2);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            margin-right: 8px;
            flex-shrink: 0;
            font-family: 'Orbitron', sans-serif;
        }
        .modal-mod-item.installed {
            opacity: 0.5;
        }
        .modal-mod-item.installed input[type="checkbox"] {
            cursor: not-allowed;
        }
        .modal-mod-item .mod-downloads {
            color: rgba(150, 150, 170, 0.7);
            font-size: 12px;
        }
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid rgba(0, 240, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 240, 255, 0.05);
        }
        .modal-footer .footer-info {
            color: rgba(200, 200, 220, 0.7);
            font-size: 13px;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--neon-magenta), var(--neon-cyan));
        }

        h2, h3 {
            font-family: 'Orbitron', sans-serif;
        }

        strong {
            color: var(--neon-cyan);
        }

        code {
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--neon-cyan);
        }

        .btn-small {
            font-size: 11px !important;
            padding: 4px 10px !important;
        }
        
        .mc-version-badge {
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 8px;
            font-family: 'Orbitron', sans-serif;
        }
        .mc-version-badge.compatible {
            background: rgba(0, 255, 136, 0.2);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
        }
        .mc-version-badge.warning {
            background: rgba(255, 136, 0, 0.2);
            color: var(--neon-orange);
            border: 1px solid var(--neon-orange);
        }
        .mc-version-badge.incompatible {
            background: rgba(255, 0, 85, 0.2);
            color: var(--neon-red);
            border: 1px solid var(--neon-red);
        }
        .compat-status {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 3px;
            margin-left: 6px;
        }
        .compat-status.green {
            background: var(--neon-green);
            color: #0a0a1a;
        }
        .compat-status.yellow {
            background: var(--neon-orange);
            color: #0a0a1a;
        }
        .compat-status.red {
            background: var(--neon-red);
            color: #fff;
        }
        .world-item.incompatible {
            opacity: 0.5;
        }
        .world-item.incompatible .world-name {
            text-decoration: line-through;
        }
        .loader-worlds-list {
            background: rgba(0, 240, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .loader-worlds-list .world-row {
            display: flex;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(0, 240, 255, 0.1);
        }
        .loader-worlds-list .world-row:last-child {
            border-bottom: none;
        }
        .loader-worlds-list .world-row.disabled {
            opacity: 0.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ NeoRunner - Minecraft Server Dashboard</h1>
            <p>Manage your modded server with ease | <strong>Ports:</strong> Game: <span id="game-port">-</span> | Query: <span id="query-port">-</span> | RCON: <span id="rcon-port">-</span> | HTTP: <span id="http-port">-</span></p>
        </header>
        
        <div id="alerts"></div>
        
        <div class="grid">
            <!-- Server Status Card -->
            <div class="card">
                <h2>Server Status</h2>
                <div id="status-content">
                    <div class="loading"></div> Loading...
                </div>
            </div>
            
             <!-- Quick Actions Card -->
            <div class="card">
                <h2>Quick Actions</h2>
                <button id="btn-start" class="success" onclick="startServer()">‚ñ∂ Start</button>
                <button id="btn-stop" class="danger" onclick="stopServer()" disabled>‚èπ Stop</button>
                <button id="btn-restart" onclick="restartServer()" style="background:#FF9800;">üîÑ Restart</button>
                <br><br>
                <button onclick="openModSelector()">üìã Browse CF/MR Mods</button>
                <button onclick="openConvertModal()" style="background:#9C27B0;">üîÑ Convert Modpack</button>
            </div>
        </div>
        
        <!-- Client Installers Card -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>Client Mod Installer</h2>
            <p style="color:#666; font-size:13px; margin-bottom:12px;">Download a script, run it on your PC, and your client mods folder will be synced with the server. Pick the one that matches your OS:</p>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <a href="/download/install-mods.bat" class="installer-btn installer-bat" download>
                    <span class="installer-icon">&#x1F4E5;</span>
                    <span class="installer-label">.bat</span>
                    <span class="installer-desc">Windows (double-click)</span>
                </a>
                <a href="/download/install-mods.ps1" class="installer-btn installer-ps1" download>
                    <span class="installer-icon">&#x1F4E5;</span>
                    <span class="installer-label">.ps1</span>
                    <span class="installer-desc">PowerShell 5.1+</span>
                </a>
                <a href="/download/install-mods.sh" class="installer-btn installer-sh" download>
                    <span class="installer-icon">&#x1F4E5;</span>
                    <span class="installer-label">.sh</span>
                    <span class="installer-desc">Linux / macOS</span>
                </a>
            </div>
            <p style="color:#888; font-size:11px; margin-top:10px;">
                <strong>One-liner (PowerShell):</strong> Right-click in PowerShell and paste, or run: 
                <code id="powershell-oneliner" style="background:#2a2a2a;padding:2px 6px;border-radius:3px;cursor:pointer;font-family:monospace;" onclick="copyToClipboard(this)" title="Click to copy">Loading...</code>
                <br><span style="color:#666;">If double-clicking .bat opens Notepad, use the one-liner or right-click .bat ‚Üí "Run with PowerShell"</span>
            </p>
        </div>
        
        <!-- World Management Card -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>üåç World Management</h2>
            <p style="color:#888; font-size:13px; margin-bottom:12px;">Manage multiple worlds. Switch between worlds by updating server.properties (takes effect on next server restart). <span id="server-mc-version-display"></span></p>
            <div style="margin-bottom: 15px;">
                <button onclick="scanWorlds()" style="background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;" title="Scan for available worlds">üåê Scan Worlds</button>
            </div>
            <div id="world-management-dedicated">
                <p style="color:#888;">Click "Scan Worlds" to discover available worlds.</p>
            </div>
        </div>
        
        <!-- Tabbed Section -->
        <div class="card">
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('server-mods')">üåê Server Mods</button>
                <button class="tab-button" onclick="switchTab('client-mods')">üíª Client Mods</button>
                <button class="tab-button" onclick="switchTab('loader')">üéÆ Loader</button>
                <button class="tab-button" onclick="switchTab('quarantine')">üîí Quarantine</button>
                <button class="tab-button" onclick="switchTab('blacklist')">üö´ Blacklist</button>
                <button class="tab-button" onclick="switchTab('config')">‚öôÔ∏è Configuration</button>
                <button class="tab-button" onclick="switchTab('events')">üîî Events</button>
                <button class="tab-button" onclick="switchTab('logs')">üìù Logs</button>
            </div>
            
            <!-- Server Mods Tab -->
            <div id="server-mods" class="tab-content active">
                <h2>üåê Server Mods</h2>
                <p style="color:#666; font-size:13px; margin-bottom:12px;">Server-side mods that run on the server. These are required for the server to function.</p>
                <div style="margin-bottom: 15px;">
                    <button class="success" onclick="openModSelector()" style="margin-right: 8px;">+ Add Mods</button>
                    <button onclick="rescanMods()" style="background: #9b59b6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Scan all mods for corrupt/incomplete files">üîç Rescan</button>
                    <button onclick="scanWorlds()" style="background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Scan for available worlds">üåê Scan Worlds</button>
                    <button onclick="analyzeMods()" style="background: #673AB7; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Analyze mods for mixin conflicts">üî¨ Analyze</button>
                    <button onclick="optimizeLoadOrder()" style="background: #009688; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Optimize mod load order for better compatibility">‚ö° Optimize Load Order</button>
                    <button onclick="patchMods()" style="background: #FF5722; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Auto-patch mods for mixin compatibility">üîß Patch Mods</button>
                </div>
                <div id="server-mods-list">
                    <div class="loading"></div> Loading server mods...
                </div>
                <!-- Compatibility Analysis Section -->
                <div id="compatibility-section" style="margin-top:20px;">
                    <h3 style="color:#673AB7; border-bottom:1px solid rgba(0,240,255,0.2); padding-bottom:8px;">üî¨ Mod Compatibility</h3>
                    <div id="compatibility-status">
                        <p style="color:#666;">Click "Analyze" to scan mods for mixin conflicts and compatibility issues.</p>
                    </div>
                </div>
            </div>
            
            <!-- Client Mods Tab -->
            <div id="client-mods" class="tab-content">
                <h2>üíª Client Mods</h2>
                <p style="color:#666; font-size:13px; margin-bottom:12px;">Client-side mods that players need to download. These are optional for server operation but required on the client for full feature support.</p>
                <div style="margin-bottom: 15px;">
                    <button class="success" onclick="openModSelector()" style="margin-right: 8px;">+ Add Mods</button>
                    <button onclick="broadcastModUpdate()" style="background: #e67e22; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;" title="Send clickable download link to all online players via in-game chat">Notify Players</button>
                    <button onclick="restoreFromQuarantine()" style="background: #FF9800; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Move all quarantined mods back to clientonly folder">üì§ Restore to Client Mods</button>
                    <button onclick="quarantineAllClientMods()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Quarantine ALL client-side mods to the quarantine folder">üîí Quarantine All Client Mods</button>
                </div>
                <div id="client-mods-list">
                    <div class="loading"></div> Loading client mods...
                </div>
            </div>
            
            <!-- Quarantine Tab -->
            <div id="quarantine" class="tab-content">
                <h2>üîí Quarantined Mods</h2>
                <p style="color:#888; font-size:13px; margin-bottom:15px;">Mods that were automatically removed due to crashes or compatibility issues. Restore them if the issue has been resolved.</p>
                <div style="margin-bottom: 15px;">
                    <button onclick="restoreAllQuarantined()" style="background: #27ae60; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 8px;" title="Restore all quarantined mods to their original folders">Restore All</button>
                    <button onclick="restoreFromQuarantine()" style="background: #FF9800; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;" title="Move all quarantined mods back to mods/clientonly folders">üì§ Restore from Quarantine</button>
                    <button onclick="quarantineAllClientMods()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Quarantine all mods with client-side functionality (render methods, client classes, etc.)">üîí Quarantine Client Mods</button>
                    <button onclick="quarantineAllMods()" style="background: #c82333; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px;" title="Quarantine all mods that cause crashes (client-only mods, dependency conflicts, etc.)">Quarantine All</button>
                </div>
                <div id="quarantine-tab-content">
                    <div class="loading"></div> Loading...
                </div>
            </div>
            
            <!-- Blacklist Tab -->
            <div id="blacklist" class="tab-content">
                <h2>üö´ Blacklist & Whitelist</h2>
                <p style="color:#888; font-size:13px; margin-bottom:15px;">Manage mods that are automatically quarantined. Blacklisted mods are always blocked, whitelisted mods are never auto-quarantined.</p>
                
                <h3 style="color:#e74c3c; border-bottom:1px solid #333; padding-bottom:8px;">Blacklist</h3>
                <p style="color:#888; font-size:12px;">Mods in this list will be automatically quarantined on startup or when detected.</p>
                <div style="display:flex; gap:8px; margin-bottom:10px;">
                    <input type="text" id="blacklist-add-input" placeholder="mod_id (e.g. emf) or regex pattern (e.g. 'decocraft.*1\.21\.1$')" style="flex:1; padding:8px; border-radius:4px; border:1px solid #555; background:#2a2a2a; color:#fff;">
                    <button onclick="addToBlacklist()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Add</button>
                </div>
                <div style="display:flex; gap:8px; margin-bottom:10px;">
                    <input type="text" id="blacklist-pattern-add-input" placeholder="regex pattern (e.g. '.*1\.21\.1$')" style="flex:1; padding:8px; border-radius:4px; border:1px solid #555; background:#2a2a2a; color:#fff;">
                    <button onclick="addToBlacklistPattern()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Add Pattern</button>
                </div>
                <div id="blacklist-content" style="margin-bottom:20px;"></div>
                
                <h3 style="color:#ff9800; border-bottom:1px solid #333; padding-bottom:8px;">Blacklist Patterns</h3>
                <p style="color:#888; font-size:12px;">Regex patterns to automatically blacklist mods matching version patterns. Use with caution!</p>
                <div style="display:flex; gap:8px; margin-bottom:10px;">
                    <input type="text" id="blacklist-pattern-remove-input" placeholder="pattern to remove" style="flex:1; padding:8px; border-radius:4px; border:1px solid #555; background:#2a2a2a; color:#fff;">
                    <button onclick="removeFromBlacklistPattern()" style="background: #ff9800; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Remove Pattern</button>
                </div>
                <div id="blacklist-patterns-content" style="margin-bottom:20px;"></div>
                
                <h3 style="color:#27ae60; border-bottom:1px solid #333; padding-bottom:8px;">Whitelist</h3>
                <p style="color:#888; font-size:12px;">Mods in this list will never be auto-quarantined (overrides blacklist).</p>
                <div style="display:flex; gap:8px; margin-bottom:10px;">
                    <input type="text" id="whitelist-add-input" placeholder="mod_id (e.g. sodium)" style="flex:1; padding:8px; border-radius:4px; border:1px solid #555; background:#2a2a2a; color:#fff;">
                    <button onclick="addToWhitelist()" style="background: #27ae60; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Add</button>
                </div>
                <div id="whitelist-content"></div>
            </div>
            
            <!-- Loader Tab -->
            <div id="loader" class="tab-content">
                <h2>üéÆ Loader Management</h2>
                <p style="color:#666; font-size:13px; margin-bottom:12px;">Manage mod loaders. Only one loader can be active at a time. Switching loaders will create a backup snapshot and archive current mods.</p>
                
                <div id="loader-status">
                    <div class="loading"></div> Loading loader information...
                </div>
                
                <h3 style="margin-top:20px; color:#FF9800; border-bottom:1px solid rgba(0,240,255,0.2); padding-bottom:8px;">üì¶ Available Loaders</h3>
                <div id="loader-list">
                    <p style="color:#666;">Loading...</p>
                </div>
                
                <h3 style="margin-top:20px; color:#00BCD4; border-bottom:1px solid rgba(0,240,255,0.2); padding-bottom:8px;">üì∏ Loader Snapshots</h3>
                <p style="color:#888; font-size:12px; margin-bottom:10px;">Full backups created when switching loaders. Contains mods and world data.</p>
                <div id="loader-snapshots">
                    <p style="color:#666;">No snapshots found.</p>
                </div>
                
                <h3 style="margin-top:20px; color:#673AB7; border-bottom:1px solid rgba(0,240,255,0.2); padding-bottom:8px;">üìÇ Archived Mods</h3>
                <div id="loader-archives">
                    <p style="color:#666;">No archived mods found.</p>
                </div>
                
                <h3 style="margin-top:20px; color:#2196F3; border-bottom:1px solid rgba(0,240,255,0.2); padding-bottom:8px;">‚öôÔ∏è Switch Loader & MC Version</h3>
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(26, 26, 46, 0.6); border-radius: 8px; border: 1px solid rgba(0, 240, 255, 0.15);">
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                        <label style="font-weight: 500;">Target Loader:</label>
                        <select id="target-loader" style="padding: 10px 15px; border-radius: 6px; border: 2px solid #2196F3; font-size: 14px;" onchange="updateLoaderWorldsPreview()">
                            <option value="neoforge">NeoForge</option>
                            <option value="forge">Forge</option>
                            <option value="fabric">Fabric</option>
                        </select>
                        <label style="font-weight: 500; margin-left: 10px;">MC Version:</label>
                        <input type="text" id="target-mc-version" placeholder="e.g. 1.21.11" value="1.21.11" style="padding: 10px 15px; border-radius: 6px; border: 2px solid #4CAF50; width: 120px; font-size: 14px;" oninput="updateLoaderWorldsPreview()">
                    </div>
                    <div id="loader-worlds-preview" style="display:none;">
                        <h4 style="margin-top:12px;margin-bottom:6px;color:#666;font-size:12px;">üåç Compatible Worlds:</h4>
                        <div id="loader-worlds-list" class="loader-worlds-list"></div>
                    </div>
                    <div style="margin-top: 12px;">
                        <button onclick="installLoader()" style="background: #9b59b6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">üì• Install Loader</button>
                        <button onclick="switchLoader()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-left: 10px; font-size: 14px;">üîÑ Switch to {loader}{mcver}</button>
                    </div>
                </div>

            </div>
            
            <!-- Configuration Tab -->
            <div id="config" class="tab-content">
                <h2>Server Configuration</h2>
                
                <h3 style="margin-top:0;color:#4CAF50;border-bottom:1px solid #333;padding-bottom:8px;">Network</h3>
                <div class="form-group">
                    <label>Hostname / Public IP</label>
                    <input type="text" id="cfg-hostname" placeholder="e.g. play.myserver.com or 192.168.0.19">
                    <small>Public-facing address for install scripts and broadcasts. Leave blank to auto-detect from server.properties.</small>
                </div>
                <div class="form-group">
                    <label>Minecraft Version</label>
                    <input type="text" id="mc-version" value="1.21.11">
                </div>
                
                <h3 style="color:#2196F3;border-bottom:1px solid #333;padding-bottom:8px;">Mod Curator</h3>
                <div class="form-group">
                    <label>Curator Sort Order</label>
                    <select id="cfg-curator-sort">
                        <option value="downloads">Downloads (most popular)</option>
                        <option value="relevance">Relevance</option>
                        <option value="follows">Follows</option>
                        <option value="newest">Newest</option>
                        <option value="updated">Recently Updated</option>
                    </select>
                    <small>Default sort for Modrinth/CurseForge mod searches</small>
                </div>
                <div class="form-group">
                    <label>Curator Limit (per source)</label>
                    <input type="number" id="cfg-curator-limit" min="10" max="200" value="100" step="10">
                    <small>Max mods to fetch from each source (10-200)</small>
                </div>
                
                <h3 style="color:#e74c3c;border-bottom:1px solid #333;padding-bottom:8px;">Server Recovery</h3>
                <div class="form-group">
                    <label>Max Restart Attempts</label>
                    <input type="number" id="cfg-max-restarts" min="1" max="100" value="25">
                    <small>How many times to auto-restart after crashes before giving up (1-100)</small>
                </div>
                <div class="form-group">
                    <label>Max Crashes Before Quarantine</label>
                    <input type="number" id="cfg-max-crashes" min="1" max="10" value="3">
                    <small>How many times a mod can crash before being auto-quarantined (1-10)</small>
                </div>
                
                <h3 style="color:#FF9800;border-bottom:1px solid #333;padding-bottom:8px;">Broadcasts &amp; Notifications</h3>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                        <input type="checkbox" id="cfg-broadcast-enabled" style="width:auto;margin:0;">
                        Enable In-Game Broadcasts
                    </label>
                    <small>Master toggle for all tellraw broadcasts to players</small>
                </div>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                        <input type="checkbox" id="cfg-broadcast-auto" style="width:auto;margin:0;">
                        Auto-Broadcast After Mod Install
                    </label>
                    <small>Automatically notify players when new mods are installed via dashboard</small>
                </div>
                
                <h3 style="color:#9C27B0;border-bottom:1px solid #333;padding-bottom:8px;">Nag Screens</h3>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                        <input type="checkbox" id="cfg-nag-modlist" style="width:auto;margin:0;">
                        Show Mod List on Player Join
                    </label>
                    <small>Send mod list via tellraw when a player joins the server</small>
                </div>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                        <input type="checkbox" id="cfg-nag-firstvisit" style="width:auto;margin:0;">
                        First-Visit Mod Selector
                    </label>
                    <small>Auto-open mod selector on first dashboard visit</small>
                </div>
                
                <h3 style="color:#00BCD4;border-bottom:1px solid #333;padding-bottom:8px;">Install Scripts</h3>
                <div class="form-group">
                    <label>Script Types to Generate</label>
                    <select id="cfg-script-types">
                        <option value="all">All (.ps1 + .sh)</option>
                        <option value="ps1">PowerShell .ps1 only</option>
                        <option value="sh">Linux/Mac .sh only</option>
                    </select>
                    <small>Which install scripts to generate for players</small>
                </div>
                
                <h3 style="color:#E91E63;border-bottom:1px solid #333;padding-bottom:8px;">
                    Java Memory
                    <button onclick="openJavaModal()" style="float:right; padding:4px 10px; font-size:12px; background:#607D8B;">‚òï Version Manager</button>
                </h3>
                <div class="form-group">
                    <label>Max Heap Size (-Xmx)</label>
                    <input type="text" id="cfg-xmx" value="6G" placeholder="e.g. 6G, 4096M, 8G">
                    <small>Maximum memory for server JVM (e.g. 6G, 8G, 16384M). Requires server restart.</small>
                </div>
                <div class="form-group">
                    <label>Initial Heap Size (-Xms)</label>
                    <input type="text" id="cfg-xms" value="4G" placeholder="e.g. 4G, 2048M, 6G">
                    <small>Starting memory allocation (e.g. 4G, 6G). Should be less than or equal to max. Requires server restart.</small>
                </div>
                
                <h3 style="color:#607D8B;border-bottom:1px solid #333;padding-bottom:8px;">Update Schedule</h3>
                <div class="form-group">
                    <label>Mod Update Frequency (hours)</label>
                    <input type="number" id="update-freq" min="1" max="24" value="4" step="1">
                    <small>How often to check for mod updates (1-24 hours)</small>
                </div>
                <div class="form-group">
                    <label>Weekly Update Day</label>
                    <select id="weekly-day">
                        <option value="mon">Monday</option>
                        <option value="tue">Tuesday</option>
                        <option value="wed">Wednesday</option>
                        <option value="thu">Thursday</option>
                        <option value="fri">Friday</option>
                        <option value="sat">Saturday</option>
                        <option value="sun">Sunday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Weekly Update Time (hour)</label>
                    <input type="number" id="weekly-hour" min="0" max="23" value="2" step="1">
                    <small>Time of day for weekly strict version check (0-23)</small>
                </div>
                
                <div style="margin-top:20px;display:flex;gap:10px;">
                    <button class="success" onclick="saveConfig()">Save Configuration</button>
                    <button onclick="loadConfig()">Reload</button>
                </div>
            </div>
            
            <!-- Events Tab -->
            <div id="events" class="tab-content">
                <h2>Server Events</h2>
                <p style="color:#666; font-size:13px; margin-bottom:12px;">Crash detection, self-healing actions, and quarantine events. Auto-refreshes every 10 seconds.</p>
                <button onclick="loadEvents()">üîÑ Refresh</button>
                <button onclick="clearEvents()" class="danger" style="margin-left:8px;">Clear Events</button>
                <div id="events-content" class="event-timeline" style="margin-top:12px;">
                    <div class="loading"></div> Loading events...
                </div>
            </div>
            
            <!-- Logs Tab -->
            <div id="logs" class="tab-content">
                <h2>Live Logs</h2>
                <button onclick="refreshLogs()">üîÑ Refresh Logs</button>
                <div id="logs-content" class="logs">
                    <div class="loading"></div> Loading logs...
                </div>
            </div>
        </div>

        <!-- Mod Selection Modal -->
        <div id="mod-selector-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2>Add Mods to Server</h2>
                    <button class="close-btn" onclick="closeModSelector()">&times;</button>
                </div>
                <div class="modal-toolbar">
                    <button class="success" onclick="selectAllMods()">Select All</button>
                    <button onclick="deselectAllMods()">Deselect All</button>
                    <input type="text" class="search-box" id="mod-search" placeholder="Search mods..." oninput="filterModList()">
                    <span class="selected-count" id="selected-count">0 selected</span>
                </div>
                <div class="modal-body" id="modal-mod-list">
                    <div style="padding: 40px; text-align: center; color: #666;">Loading mod list...</div>
                </div>
                <div class="modal-footer">
                    <span class="footer-info" id="modal-footer-info">Top mods from Modrinth</span>
                    <div>
                        <button onclick="closeModSelector()">Cancel</button>
                        <button class="success" onclick="installSelectedMods()" id="install-btn">Install Selected</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modpack Conversion Modal -->
        <div id="convert-modal" class="modal-overlay">
            <div class="modal" style="max-width: 900px;">
                <div class="modal-header">
                    <h2 style="color: #9C27B0;">üîÑ Convert Modpack</h2>
                    <button class="close-btn" onclick="closeConvertModal()">&times;</button>
                </div>
                <div class="modal-body" style="padding: 24px;">
                    <!-- Step 1: Input -->
                    <div id="convert-input">
                        <p style="color:#666; margin-bottom:15px;">
                            Paste your mod folder's filenames below (one per line), or drag & drop .jar files. 
                            The server will search Modrinth for each mod and check if a compatible version exists 
                            for your server's MC version and loader.
                        </p>
                        <div style="display:flex; gap:15px; margin-bottom:15px;">
                            <div style="flex:1;">
                                <label>Source Loader <small style="color:#999;">(optional)</small></label>
                                <select id="convert-source-loader" style="margin-top:4px;">
                                    <option value="fabric">Fabric</option>
                                    <option value="forge">Forge</option>
                                    <option value="neoforge">NeoForge</option>
                                    <option value="quilt">Quilt</option>
                                    <option value="unknown">Unknown</option>
                                </select>
                            </div>
                            <div style="flex:1;">
                                <label>Source MC Version <small style="color:#999;">(optional)</small></label>
                                <input type="text" id="convert-source-version" placeholder="e.g. 1.21.4" style="margin-top:4px;">
                            </div>
                        </div>
                        <div id="convert-dropzone" style="border: 2px dashed rgba(0,240,255,0.4); border-radius:8px; padding:30px; text-align:center; cursor:pointer; margin-bottom:15px; transition: border-color 0.2s, background 0.2s;">
                            <p style="color:#888; margin:0;">üìÇ Drag & drop .jar files here, or click to browse</p>
                            <input type="file" id="convert-file-input" multiple accept=".jar" style="display:none;" onchange="handleConvertFiles(this.files)">
                        </div>
                        <label>Or paste filenames (one per line):</label>
                        <textarea id="convert-filenames" rows="8" placeholder="sodium-fabric-0.6.5+mc1.21.4.jar&#10;iris-fabric-1.8.8+mc1.21.4.jar&#10;modmenu-13.0.3.jar&#10;..." style="font-family: monospace; font-size:12px;"></textarea>
                        <div style="margin-top:10px; display:flex; justify-content:flex-end;">
                            <button onclick="closeConvertModal()">Cancel</button>
                            <button class="success" onclick="runConversion()" id="convert-run-btn" style="background:#9C27B0;">Analyze Modpack</button>
                        </div>
                    </div>
                    <!-- Step 2: Results (hidden until analysis completes) -->
                    <div id="convert-results" style="display:none;">
                        <div id="convert-summary" style="margin-bottom:15px;"></div>
                        <div id="convert-results-list" style="max-height:400px; overflow-y:auto;"></div>
                        <div style="margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <button onclick="showConvertInput()">‚Üê Back</button>
                            <div>
                                <span id="convert-select-count" style="color:#666; font-size:13px; margin-right:10px;">0 selected</span>
                                <button class="success" onclick="installConvertedMods()" id="convert-install-btn" style="background:#9C27B0;">Install Selected</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Java Upgrade Modal -->
        <div id="java-modal" class="modal-overlay">
            <div class="modal" style="max-width: 600px;">
                <div class="modal-header">
                    <h2>‚òï Java Version Manager</h2>
                    <button class="close-btn" onclick="closeJavaModal()">√ó</button>
                </div>
                <div class="modal-body" style="padding: 24px;">
                    <div style="background:#2a2a2a; padding:15px; border-radius:8px; margin-bottom:20px;">
                        <div style="font-size:12px; color:#888;">Current Java Version</div>
                        <div id="java-current" style="font-size:24px; font-weight:bold; color:#4CAF50;">Loading...</div>
                    </div>
                    
                    <div id="java-quarantined-section" style="display:none; margin-bottom:20px;">
                        <h3 style="color:#FF5722; margin-bottom:10px;">‚ö†Ô∏è Quarantined Mods</h3>
                        <p style="color:#888; font-size:13px; margin-bottom:10px;">These mods need a newer Java version:</p>
                        <div id="java-quarantined-list" style="max-height:150px; overflow-y:auto;"></div>
                    </div>
                    
                    <div id="java-upgrade-section">
                        <h3 style="margin-bottom:10px;">Available JDK Upgrades</h3>
                        <div id="java-upgrades-list">Loading available packages...</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeJavaModal()">Close</button>
                    <button id="java-unquarantine-btn" class="success" onclick="unquarantineJavaMods()" style="display:none;">Restore Quarantined Mods</button>
                </div>
            </div>
        </div>
    </div>
    
        <script>
            // Tab switching
            function switchTab(tabId) {
                document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                event.target.classList.add('active');
            }
            
            function showAlert(msg, type) {
                const alertsDiv = document.getElementById('alerts');
                const className = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-error' : 'alert-info';
                alertsDiv.innerHTML = `<div class="alert ${className}">${msg}</div>`;
                setTimeout(() => alertsDiv.innerHTML = '', 3000);
            }
            
            function refreshStatus() {
                fetch('/api/status')
                    .then(r => r.json())
                    .then(data => {
                        const content = document.getElementById('status-content') || document.querySelector('.card .stat');
                        if (content) {
                            const running = data.running ? 
                                '<span class="status-badge status-running">Running</span>' : 
                                '<span class="status-badge status-stopped">Stopped</span>';
                            content.innerHTML = `
                                <div class="stat"><span class="stat-label">Status</span><span class="stat-value">${running}</span></div>
                                <div class="stat"><span class="stat-label">Loader</span><span class="stat-value">${data.loader || 'unknown'}</span></div>
                                <div class="stat"><span class="stat-label">MC Version</span><span class="stat-value">${data.mc_version || 'unknown'}</span></div>
                                <div class="stat"><span class="stat-label">Mods</span><span class="stat-value">${data.mod_count || 0}</span></div>
                                <div class="stat"><span class="stat-label">Players</span><span class="stat-value">${data.player_count || 0}</span></div>
                            `;
                        }
                        const btnStart = document.getElementById('btn-start');
                        const btnStop = document.getElementById('btn-stop');
                        if (btnStart) btnStart.disabled = data.running;
                        if (btnStop) btnStop.disabled = !data.running;
                    }).catch(() => {});
            }
            
            function refreshMods() {
                loadServerMods();
                loadClientMods();
            }
            
            function loadConfig() {
                fetch('/api/config').then(r => r.json()).then(cfg => {
                    if (document.getElementById('mc-version')) document.getElementById('mc-version').value = cfg.mc_version || '1.21.11';
                    if (document.getElementById('update-freq')) document.getElementById('update-freq').value = cfg.ferium_update_interval_hours || 4;
                    
                    // Feature 15: Populate port display in header
                    const serverIp = cfg.hostname || cfg.server_ip || window.location.hostname || 'localhost';
                    const httpPort = cfg.http_port || 8000;
                    if (document.getElementById('game-port')) document.getElementById('game-port').textContent = cfg.server_port || '25565';
                    if (document.getElementById('query-port')) document.getElementById('query-port').textContent = cfg.query_port || '25565';
                    if (document.getElementById('rcon-port')) document.getElementById('rcon-port').textContent = cfg.rcon_port || '25575';
                    if (document.getElementById('http-port')) document.getElementById('http-port').textContent = httpPort;
                    
                    // Feature 14: Populate PowerShell one-liner
                    const onelinerEl = document.getElementById('powershell-oneliner');
                    if (onelinerEl) {
                        const oneliner = `iwr http://${serverIp}:${httpPort}/download/install-mods.ps1 | iex`;
                        onelinerEl.textContent = oneliner;
                    }
                }).catch(() => {});
            }
            
            function refreshLogs() {
                fetch('/api/logs?lines=50').then(r => r.json()).then(data => {
                    const content = document.getElementById('logs-content');
                    if (content && data.logs) {
                        content.innerHTML = data.logs.map(l => `<div class="log-line">${l}</div>`).join('');
                    }
                }).catch(() => {});
            }
            
            function loadQuarantine() {
                fetch('/api/quarantine').then(r => r.json()).then(data => {
                    const content = document.getElementById('quarantine-tab-content');
                    if (content) {
                        if (data.mods && data.mods.length) {
                            content.innerHTML = data.mods.map(m => `
                                <div class="quarantine-item">
                                    <div class="q-info">
                                        <span class="q-name">${m.name || m.id}</span>
                                        <span class="q-reason">${m.reason || 'Unknown'}</span>
                                    </div>
                                    <button class="q-restore" onclick="restoreMod('${m.id}')">Restore</button>
                                </div>
                            `).join('');
                        } else {
                            content.innerHTML = '<p style="color:#666;">No quarantined mods</p>';
                        }
                    }
                }).catch(() => {});
            }
            
            function loadBlacklist() {
                fetch('/api/blacklist').then(r => r.json()).then(data => {
                    const content = document.getElementById('blacklist-content');
                    if (content) {
                        content.innerHTML = (data.mods || []).map(m => `<div class="mod-item"><span>${m}</span></div>`).join('') || '<p style="color:#666;">No blacklisted mods</p>';
                    }
                }).catch(() => {});
            }
            
            function loadEvents() {
                fetch('/api/events').then(r => r.json()).then(data => {
                    const content = document.getElementById('events-content');
                    if (content) {
                        content.innerHTML = (data.events || []).map(e => `
                            <div class="event-item">
                                <span class="event-time">${e.time || ''}</span>
                                <span class="event-type event-type-${(e.type || 'default').toLowerCase()}">${e.type || ''}</span>
                                <span class="event-msg">${e.message || ''}</span>
                            </div>
                        `).join('') || '<p style="color:#666;">No events</p>';
                    }
                }).catch(() => {});
            }
            
            function openModSelector() {
                document.getElementById('mod-selector-modal').classList.add('active');
            }
            
            function closeModSelector() {
                document.getElementById('mod-selector-modal').classList.remove('active');
            }
            
            function rescanMods() {
                showAlert('Rescanning mods...', 'info');
                fetch('/api/rescan-mods', {method: 'POST'}).then(r => r.json()).then(data => {
                    showAlert(data.message || 'Rescan complete', 'success');
                    loadServerMods();
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function analyzeMods() {
                showAlert('Analyzing mods for mixin conflicts...', 'info');
                fetch('/api/mods/analyze').then(r => r.json()).then(data => {
                    if (data.status === 'success') {
                        const conflictCount = data.conflicts?.length || 0;
                        const msg = `Found ${data.mods_scanned} mods, ${conflictCount} potential conflicts`;
                        showAlert(msg, 'success');
                        updateCompatibilityStatus(data);
                    } else {
                        showAlert(data.error || 'Analysis failed', 'error');
                    }
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function optimizeLoadOrder() {
                if (!confirm('Optimize mod load order? This will rename mods with priority prefixes (APIs first, addons last).')) return;
                showAlert('Optimizing load order...', 'info');
                fetch('/api/mods/optimize-load-order', {method: 'POST'}).then(r => r.json()).then(data => {
                    if (data.status === 'success') {
                        showAlert(`Optimized ${data.renamed?.length || 0} mods`, 'success');
                        loadServerMods();
                    } else {
                        showAlert(data.error || 'Optimization failed', 'error');
                    }
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function patchMods() {
                if (!confirm('Auto-patch mods for mixin compatibility? This modifies mod JARs. Backups will be created.')) return;
                showAlert('Patching mods...', 'info');
                fetch('/api/mods/patch', {method: 'POST'}).then(r => r.json()).then(data => {
                    if (data.status === 'success') {
                        showAlert(`Patched ${data.patched || 0} mods, skipped ${data.skipped || 0}`, 'success');
                    } else {
                        showAlert(data.error || 'Patching failed', 'error');
                    }
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function loadLoaders() {
                fetch('/api/loaders').then(r => r.json()).then(data => {
                    updateLoaderStatus(data);
                    updateLoaderList(data);
                }).catch(() => {});
                
                fetch('/api/loaders/archives').then(r => r.json()).then(data => {
                    updateLoaderArchives(data.archives || []);
                }).catch(() => {});
                
                fetch('/api/loaders/snapshots').then(r => r.json()).then(data => {
                    updateLoaderSnapshots(data.snapshots || []);
                }).catch(() => {});
            }
            
            function updateLoaderSnapshots(snapshots) {
                const container = document.getElementById('loader-snapshots');
                if (!container) return;
                
                if (!snapshots.length) {
                    container.innerHTML = '<p style="color:#666;">No snapshots found. Snapshots are created automatically when switching loaders.</p>';
                    return;
                }
                
                let html = '<div style="background:rgba(26,26,46,0.6);padding:12px;border-radius:4px;border:1px solid rgba(0,240,255,0.15);">';
                snapshots.forEach(snap => {
                    const worldIcon = snap.has_world ? 'üåç' : 'üìÅ';
                    const worldText = snap.has_world ? ' (world included)' : '';
                    html += `<div style="padding:8px;border-bottom:1px solid rgba(0,240,255,0.15);">
                        <strong>${worldIcon} ${snap.name}</strong>
                        <span style="color:#888;font-size:12px;">${snap.loader} ${snap.mc_version}</span>
                        <span style="color:#2196F3;font-size:12px;margin-left:8px;">${snap.mod_count} mods${worldText}</span>
                    </div>`;
                });
                html += '</div>';
                container.innerHTML = html;
            }
            
            function updateLoaderStatus(data) {
                const container = document.getElementById('loader-status');
                if (!container) return;
                
                container.innerHTML = `
                    <div style="background:rgba(26,26,46,0.6);padding:12px;border-radius:4px;border:1px solid rgba(0,240,255,0.15);">
                        <p><strong>Current Loader:</strong> <span style="color:#4CAF50;text-transform:uppercase;font-weight:bold;">${data.current || 'neoforge'}</span></p>
                        <p><strong>MC Version:</strong> ${data.mc_version || '1.21.11'}</p>
                        <p><strong>Active Snapshot:</strong> <code>${data.current || 'neoforge'}${data.mc_version || '1.21.11'}/</code></p>
                    </div>
                `;
            }
            
            function updateLoaderList(data) {
                const container = document.getElementById('loader-list');
                if (!container) return;
                
                const loaders = data.loaders || [];
                let html = '<div style="background:rgba(26,26,46,0.6);padding:12px;border-radius:4px;border:1px solid rgba(0,240,255,0.15);">';
                
                loaders.forEach(loader => {
                    const isCurrent = loader.name === data.current;
                    const statusColor = loader.installed ? '#4CAF50' : '#e74c3c';
                    const statusText = loader.installed ? (loader.version || 'installed') : 'not installed';
                    const badge = isCurrent ? '<span style="background:#4CAF50;color:white;padding:2px 8px;border-radius:3px;font-size:11px;margin-left:8px;">ACTIVE</span>' : '';
                    
                    html += `<div style="padding:8px;border-bottom:1px solid rgba(0,240,255,0.15);">
                        <strong style="text-transform:capitalize;">${loader.name}</strong>${badge}
                        <span style="color:${statusColor};font-size:12px;margin-left:8px;">${statusText}</span>
                    </div>`;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            function updateLoaderArchives(archives) {
                const container = document.getElementById('loader-archives');
                if (!container) return;
                
                if (!archives.length) {
                    container.innerHTML = '<p style="color:#666;">No archived mods found.</p>';
                    return;
                }
                
                let html = '<div style="background:rgba(26,26,46,0.6);padding:12px;border-radius:4px;border:1px solid rgba(0,240,255,0.15);">';
                archives.forEach(archive => {
                    html += `<div style="padding:8px;border-bottom:1px solid rgba(0,240,255,0.15);">
                        <strong style="text-transform:capitalize;">${archive.loader}</strong> ${archive.version || ''}
                        <span style="color:#888;font-size:12px;">(${archive.mc_version})</span>
                        <span style="color:#2196F3;font-size:12px;margin-left:8px;">${archive.mod_count} mods</span>
                    </div>`;
                });
                html += '</div>';
                container.innerHTML = html;
            }
            
            function installLoader() {
                const loader = document.getElementById('target-loader').value;
                const mcVersion = document.getElementById('target-mc-version').value || '1.21.11';
                
                if (!confirm(`Install ${loader} server for MC ${mcVersion}?\n\nThis will download and set up the ${loader} mod loader.`)) return;
                showAlert(`Installing ${loader} for MC ${mcVersion}...`, 'info');
                
                fetch('/api/loaders/install', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({loader: loader, mc_version: mcVersion})
                }).then(r => r.json()).then(data => {
                    if (data.success) {
                        showAlert(`Successfully installed ${loader} for MC ${mcVersion}`, 'success');
                        loadLoaders();
                    } else {
                        showAlert(data.error || 'Installation failed', 'error');
                    }
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function switchLoader() {
                const loader = document.getElementById('target-loader').value;
                const mcVersion = document.getElementById('target-mc-version').value || '1.21.11';
                
                let incompatibleWorlds = [];
                let warningWorlds = [];
                cachedWorlds.forEach(w => {
                    const compat = getCompatibilityStatus(w.mc_version, mcVersion);
                    if (compat.status === 'incompatible') incompatibleWorlds.push(w.name);
                    else if (compat.status === 'warning') warningWorlds.push(w.name);
                });
                
                let worldWarning = '';
                if (incompatibleWorlds.length > 0) {
                    worldWarning = `\n\n‚ö†Ô∏è WARNING: ${incompatibleWorlds.length} world(s) are INCOMPATIBLE with MC ${mcVersion}:\n‚Ä¢ ${incompatibleWorlds.join('\n‚Ä¢ ')}\nThese worlds may experience chunk corruption or data loss.`;
                }
                if (warningWorlds.length > 0) {
                    worldWarning += `\n\n‚ö†Ô∏è NOTE: ${warningWorlds.length} world(s) have minor version mismatch:\n‚Ä¢ ${warningWorlds.join('\n‚Ä¢ ')}\nThese may have minor issues but should work.`;
                }
                
                let confirmMsg = `Switch to ${loader} for MC ${mcVersion}?\n\nThis will:\n1. Create backup snapshot at {current_loader}{current_mc}/ (mods + world)\n2. Archive current mods\n3. Restore any mods found for ${loader} ${mcVersion}${worldWarning}\n\nProceed?`;
                
                if (!confirm(confirmMsg)) return;
                showAlert(`Switching to ${loader}${mcVersion}...`, 'info');
                
                fetch('/api/loaders/switch', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({loader: loader, mc_version: mcVersion})
                }).then(r => r.json()).then(data => {
                    if (data.success) {
                        const backup = data.backup || {};
                        const archive = data.archive || {};
                        const restore = data.restore || {};
                        const backupMods = (backup.mods || 0) + (backup.clientonly || 0);
                        const archiveMods = (archive.mods || 0) + (archive.clientonly || 0);
                        const restoreMods = (restore.restored?.mods || 0) + (restore.restored?.clientonly || 0);
                        
                        let msg = `Switched to ${loader}${mcVersion}!\n`;
                        msg += `Backup: ${backupMods} mods, world=${backup.world || false}\n`;
                        msg += `Archived: ${archiveMods} mods\n`;
                        msg += `Restored: ${restoreMods} mods`;
                        
                        showAlert(msg, 'success');
                        loadLoaders();
                        loadWorlds();
                    } else {
                        showAlert(data.error || 'Switch failed', 'error');
                    }
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function updateCompatibilityStatus(data) {
                const container = document.getElementById('compatibility-status');
                if (!container) return;
                
                const conflicts = data.conflicts || [];
                const resolved = data.resolved || 0;
                
                let html = `<p style="color:#666;">Analyzed ${data.mods_scanned} mods`;
                if (conflicts.length) {
                    html += `, found <strong style="color:#e74c3c;">${conflicts.length} potential conflicts</strong>`;
                } else {
                    html += `, <strong style="color:#4CAF50;">no conflicts detected</strong>`;
                }
                if (resolved) {
                    html += `, resolved <strong style="color:#2196F3;">${resolved}</strong>`;
                }
                html += '.</p>';
                
                if (conflicts.length) {
                    html += '<details style="margin-top:8px;"><summary style="cursor:pointer;color:#666;">View conflict details</summary>';
                    html += '<div style="background:rgba(26,26,46,0.6);padding:8px;margin-top:8px;border-radius:4px;border:1px solid rgba(255,0,85,0.3);">';
                    conflicts.slice(0, 10).forEach(c => {
                        html += `<div style="margin-bottom:4px;"><strong>${c.target}</strong>: ${c.mods?.join(', ') || 'unknown'}</div>`;
                    });
                    if (conflicts.length > 10) {
                        html += `<div style="color:#888;">...and ${conflicts.length - 10} more</div>`;
                    }
                    html += '</div></details>';
                }
                
                container.innerHTML = html;
            }
            
            function scanWorlds() {
                showAlert('Scanning worlds...', 'info');
                fetch('/api/worlds/scan', {method: 'POST'}).then(r => r.json()).then(data => {
                    const count = data.worlds?.length || 0;
                    showAlert(`Found ${count} worlds`, 'success');
                    updateWorldSwitcher(data.worlds || [], data.current, data.server_mc_version);
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            let cachedWorlds = [];
            let cachedServerMcVersion = 'unknown';
            
            function loadWorlds() {
                fetch('/api/worlds').then(r => r.json()).then(data => {
                    cachedWorlds = data.worlds || [];
                    cachedServerMcVersion = data.server_mc_version || 'unknown';
                    updateWorldSwitcher(cachedWorlds, data.current, cachedServerMcVersion);
                    updateLoaderWorldsPreview();
                }).catch(() => {});
            }
            
            function parseMcVersion(version) {
                if (!version) return null;
                const parts = String(version).split('.');
                return {
                    major: parseInt(parts[0]) || 0,
                    minor: parseInt(parts[1]) || 0,
                    patch: parseInt(parts[2]) || 0,
                    full: version
                };
            }
            
            function getCompatibilityStatus(worldVersion, serverVersion) {
                const wv = parseMcVersion(worldVersion);
                const sv = parseMcVersion(serverVersion);
                
                if (!wv || !sv) return { status: 'unknown', label: 'Unknown' };
                if (wv.full === sv.full) return { status: 'compatible', label: 'Compatible' };
                if (wv.major === sv.major && wv.minor === sv.minor) {
                    return { status: 'warning', label: 'May have issues' };
                }
                return { status: 'incompatible', label: 'Incompatible' };
            }
            
            function updateWorldSwitcher(worlds, current, serverMcVersion) {
                const container = document.getElementById('world-switcher');
                const dedicated = document.getElementById('world-management-dedicated');
                const versionDisplay = document.getElementById('server-mc-version-display');
                
                if (versionDisplay) {
                    versionDisplay.innerHTML = `Server MC: <strong style="color:#4CAF50;">${serverMcVersion || 'unknown'}</strong>`;
                }
                
                if (!worlds.length) {
                    if (container) container.innerHTML = '<p style="color:#666;">No worlds found. Create a world in-game first.</p>';
                    if (dedicated) dedicated.innerHTML = '<p style="color:#666;">No worlds found. Create a world in-game first.</p>';
                    return;
                }
                
                const sizeMB = (bytes) => (bytes / 1024 / 1024).toFixed(1);
                const worldList = worlds.map(w => {
                    const isCurrent = w.name === current;
                    const wMcVer = w.mc_version || 'unknown';
                    const compat = getCompatibilityStatus(wMcVer, serverMcVersion);
                    
                    const activeBadge = isCurrent ? '<span style="background:#4CAF50;color:white;padding:2px 6px;border-radius:3px;font-size:11px;margin-left:8px;">ACTIVE</span>' : '';
                    const size = w.size ? `<span style="color:#888;font-size:12px;">(${sizeMB(w.size)} MB)</span>` : '';
                    
                    const mcBadge = `<span class="mc-version-badge ${compat.status}">MC ${wMcVer}</span>`;
                    const compatBadge = `<span class="compat-status ${compat.status === 'compatible' ? 'green' : compat.status === 'warning' ? 'yellow' : 'red'}">${compat.label}</span>`;
                    
                    const isIncompatible = compat.status === 'incompatible';
                    const isWarning = compat.status === 'warning';
                    
                    const btn = isCurrent ? '' : 
                        `<button onclick="switchWorld('${w.name}', '${wMcVer}', '${serverMcVersion}', '${compat.status}')" 
                            style="background:${isIncompatible ? '#e74c3c' : isWarning ? '#FF9800' : '#2196F3'};
                            color:white;border:none;padding:4px 12px;border-radius:4px;cursor:pointer;margin-left:8px;font-size:12px;"
                            ${isIncompatible ? 'title="WARNING: This world is incompatible with server MC version"' : ''}>
                            ${isIncompatible ? '‚ö†Ô∏è Switch' : 'Switch'}
                        </button>`;
                    
                    return `<div class="world-item ${isIncompatible ? 'incompatible' : ''}" style="padding:8px;border-bottom:1px solid rgba(0,240,255,0.15);">
                        <span class="world-name" style="font-weight:${isCurrent ? 'bold' : 'normal'};">${w.name}</span> ${mcBadge} ${compatBadge} ${size} ${activeBadge} ${btn}
                    </div>`;
                }).join('');
                
                const worldHtml = `
                    <p style="color:#888;margin-bottom:10px;">Current world: <strong>${current}</strong> | ${worlds.length} world(s) found</p>
                    <div style="background:rgba(26,26,46,0.6);border-radius:4px;border:1px solid rgba(0,240,255,0.15);">${worldList}</div>
                    <p style="color:#888;font-size:11px;margin-top:8px;">World changes take effect on next server restart. <strong style="color:#e74c3c;">Red worlds are incompatible</strong> - switching may cause chunk corruption or data loss.</p>
                `;
                
                if (container) container.innerHTML = worldHtml;
                if (dedicated) dedicated.innerHTML = worldHtml;
            }
            
            function switchWorld(worldName, worldMcVersion, serverMcVersion, compatStatus) {
                const wv = worldMcVersion || 'unknown';
                const sv = serverMcVersion || 'unknown';
                
                let confirmMsg = `Switch to world "${worldName}"?\n\n`;
                let confirmTitle = 'Switch World';
                
                if (compatStatus === 'incompatible') {
                    confirmMsg = `‚ö†Ô∏è WARNING: VERSION MISMATCH ‚ö†Ô∏è\n\nWorld MC version: ${wv}\nServer MC version: ${sv}\n\nThis world was created with a DIFFERENT MAJOR VERSION of Minecraft.\n\nSwitching may cause:\n‚Ä¢ Chunk corruption\n‚Ä¢ Data loss\n‚Ä¢ Missing blocks/entities\n‚Ä¢ World may fail to load\n\nAre you SURE you want to proceed?`;
                    if (!confirm(confirmMsg)) return;
                    confirmMsg = `FINAL WARNING: You are about to switch to an INCOMPATIBLE world.\n\nType "CONFIRM" to proceed with switching to "${worldName}".`;
                    const input = prompt(confirmMsg);
                    if (input !== 'CONFIRM') {
                        showAlert('World switch cancelled.', 'info');
                        return;
                    }
                } else if (compatStatus === 'warning') {
                    confirmMsg = `‚ö†Ô∏è Version Mismatch Warning\n\nWorld MC version: ${wv}\nServer MC version: ${sv}\n\nThis world was created with the same major.minor version but a different patch.\n\nSome blocks or features may not work correctly, but major corruption is unlikely.\n\nSwitch to world "${worldName}"?`;
                    if (!confirm(confirmMsg)) return;
                } else {
                    confirmMsg = `Switch to world "${worldName}"?\n\nWorld version (${wv}) matches server version (${sv}).\n\nThis will take effect after restarting the server.`;
                    if (!confirm(confirmMsg)) return;
                }
                
                fetch('/api/worlds/switch', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({world: worldName})
                }).then(r => r.json()).then(data => {
                    if (data.success) {
                        showAlert(data.message, 'success');
                        loadWorlds();
                    } else {
                        showAlert('Error: ' + data.error, 'error');
                    }
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function updateLoaderWorldsPreview() {
                const loader = document.getElementById('target-loader')?.value;
                const mcVersion = document.getElementById('target-mc-version')?.value;
                const previewDiv = document.getElementById('loader-worlds-preview');
                const listDiv = document.getElementById('loader-worlds-list');
                
                if (!previewDiv || !listDiv || !cachedWorlds.length) return;
                
                previewDiv.style.display = 'block';
                
                let html = '';
                cachedWorlds.forEach(w => {
                    const wMcVer = w.mc_version || 'unknown';
                    const compat = getCompatibilityStatus(wMcVer, mcVersion);
                    const isCompatible = compat.status === 'compatible';
                    const isWarning = compat.status === 'warning';
                    const isIncompatible = compat.status === 'incompatible';
                    
                    const mcBadge = `<span class="mc-version-badge ${compat.status}">MC ${wMcVer}</span>`;
                    const statusLabel = `<span style="color:${isCompatible ? '#4CAF50' : isWarning ? '#FF9800' : '#e74c3c'};font-size:11px;margin-left:6px;">${compat.label}</span>`;
                    
                    html += `<div class="world-row ${isIncompatible ? 'disabled' : ''}">
                        <span style="${isIncompatible ? 'text-decoration:line-through;color:#888;' : ''}">${w.name}</span>
                        ${mcBadge}${statusLabel}
                    </div>`;
                });
                
                listDiv.innerHTML = html || '<p style="color:#666;font-size:12px;">No worlds found</p>';
            }
            
            function broadcastModUpdate() {
                if (!confirm('Send mod update notification to all online players?')) return;
                fetch('/api/broadcast-mods', {method: 'POST'}).then(r => r.json()).then(data => {
                    showAlert(data.message || 'Broadcast sent', 'success');
                }).catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            function saveConfig() {
                const cfg = {
                    mc_version: document.getElementById('mc-version')?.value,
                    ferium_update_interval_hours: parseInt(document.getElementById('update-freq')?.value || 4),
                };
                fetch('/api/config', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(cfg)})
                    .then(r => r.json()).then(data => showAlert('Config saved', 'success'))
                    .catch(err => showAlert('Error: ' + err, 'error'));
            }
            
            // Auto-refresh status every 5 seconds
            setInterval(refreshStatus, 5000);
            setInterval(refreshMods, 30000);
            setInterval(loadQuarantine, 15000);
            setInterval(loadEvents, 10000);
            
            // New functions for mod management
            function quarantineClientMods() {
                if (!confirm('Quarantine all mods with client-side functionality? This will move them to quarantine folder.')) return;
                
                fetch('/api/quarantine-client-mods', { method: 'POST' })
                    .then(r => r.json())
                    .then(result => {
                        if (result.success) {
                            showAlert(`Quarantined ${result.quarantined} client mods`, 'success');
                            loadMods();
                            loadClientMods();
                        } else {
                            showAlert(`Error: ${result.error}`, 'error');
                        }
                    })
                    .catch(err => showAlert(`Error: ${err}`, 'error'));
            }
            
            function loadServerMods() {
                fetch('/api/server-mods')
                    .then(r => r.json())
                    .then(data => {
                        const content = document.getElementById('server-mods-list');
                        if (data.mods && data.mods.length) {
                            content.innerHTML = data.mods.map(mod => `
                                <div class="mod-item">
                                    <div class="mod-info">
                                        <span class="mod-name">${mod.name || mod.id}</span>
                                        <span class="mod-size">${mod.size || ''}</span>
                                    </div>
                                </div>
                            `).join('');
                        } else {
                            content.innerHTML = '<p style="color:#666;">No server mods installed</p>';
                        }
                    })
                    .catch(() => {
                        document.getElementById('server-mods-list').innerHTML = '<p style="color:#c00;">Error loading server mods</p>';
                    });
            }
            
            function loadClientMods() {
                fetch('/api/client-mods')
                    .then(r => r.json())
                    .then(data => {
                        const content = document.getElementById('client-mods-list');
                        if (data.mods && data.mods.length) {
                            content.innerHTML = data.mods.map(mod => `
                                <div class="mod-item">
                                    <div class="mod-info">
                                        <span class="mod-name">${mod.name || mod.id}</span>
                                        <span class="mod-size">${mod.size || ''}</span>
                                    </div>
                                    <div class="mod-actions">
                                        <button onclick="quarantineMod('${mod.id}')" class="btn-small">Quarantine</button>
                                    </div>
                                </div>
                            `).join('');
                        } else {
                            content.innerHTML = '<p style="color:#666;">No client mods installed</p>';
                        }
                    })
                    .catch(() => {
                        document.getElementById('client-mods-list').innerHTML = '<p style="color:#c00;">Error loading client mods</p>';
                    });
            }
            
            function quarantineAllClientMods() {
                if (!confirm('Quarantine ALL client-side mods? This will move all client mods to the quarantine folder.')) return;
                
                fetch('/api/quarantine-all-client-mods', { method: 'POST' })
                    .then(r => r.json())
                    .then(result => {
                        if (result.success) {
                            showAlert(`Quarantined ${result.quarantined} client mods`, 'success');
                            loadClientMods();
                        } else {
                            showAlert(`Error: ${result.error}`, 'error');
                        }
                    })
                    .catch(err => showAlert(`Error: ${err}`, 'error'));
            }
            
            function restoreFromQuarantine() {
                if (!confirm('Restore ALL quarantined mods back to mods/clientonly folders?')) return;
                
                fetch('/api/restore-from-quarantine', { method: 'POST' })
                    .then(r => r.json())
                    .then(result => {
                        if (result.success) {
                            showAlert(`Restored ${result.restored} mods from quarantine`, 'success');
                            loadClientMods();
                            loadQuarantine();
                        } else {
                            showAlert(`Error: ${result.error}`, 'error');
                        }
                    })
                    .catch(err => showAlert(`Error: ${err}`, 'error'));
            }
            
            function quarantineMod(modId) {
                if (!confirm('Are you sure you want to quarantine this client mod?')) return;
                
                fetch('/api/quarantine-mod', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ modId })
                })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showAlert('Mod quarantined successfully', 'success');
                        loadClientMods();
                    } else {
                        showAlert('Error quarantining mod: ' + data.error, 'error');
                    }
                })
                .catch(err => {
                    showAlert('Error quarantining mod: ' + err, 'error');
                });
            }
            
            // Initial load
            document.addEventListener('DOMContentLoaded', function() {
                refreshStatus();
                loadServerMods();
                loadClientMods();
                loadConfig();
                refreshLogs();
                loadQuarantine();
                loadBlacklist();
                loadEvents();
                loadWorlds();
                loadLoaders();
                
                // First-visit check: show mod selector if never loaded AND config allows it
                if (!localStorage.getItem('neorunner-mods-loaded')) {
                    fetch('/api/config').then(r => r.json()).then(cfg => {
                        if (cfg.nag_first_visit_modal !== false) {
                            setTimeout(openModSelector, 1500);
                        }
                        localStorage.setItem('neorunner-mods-loaded', 'true');
                    }).catch(() => {
                        setTimeout(openModSelector, 1500);
                        localStorage.setItem('neorunner-mods-loaded', 'true');
                    });
                }
            });
        </script>
</body>
</html>
